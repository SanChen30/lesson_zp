<view class="container">
  <!-- Header -->
  <view class="header">
    <text class="room-id">房间号: {{roomInfo.room_number || '加载中...'}}</text>
    <text class="money-ratio">比例: 1分 = {{roomInfo.money_ratio || 0}}元</text>
  </view>

  <!-- Player Grid Section -->
  <view class="player-grid-section">
    <text class="section-title">当前积分</text>
    <view class="player-grid">
      <view class="player-item" wx:for="{{players}}" wx:key="openid">
        <view class="player-card">
          <image class="avatar" src="{{item.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill" />
          <view class="player-info">
            <text class="nickname">{{item.nickname || '玩家'}}</text>
            <text class="score {{item.current_score >= 0 ? 'positive' : 'negative'}}">{{item.current_score}}</text>
            <text class="money">¥{{item.current_money}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- History Section -->
  <view class="history-section">
    <text class="section-title">历史记录</text>
    <scroll-view class="history-list" scroll-y="true">
      <view class="history-item" wx:for="{{records}}" wx:key="index">
        <view class="history-header">
          <text class="history-title">第{{item.round_number}}轮</text>
        </view>
        <view class="history-content">{{formatRecord(item.scores)}}</view>
      </view>
    </scroll-view>
  </view>

  <!-- Floating Action Button -->
  <view class="fab-container" bind:tap="showScoringModal">
    <button class="fab-button">记录分数</button>
  </view>

  <!-- Footer -->
  <view class="footer">
    <button class="end-game-button" bind:tap="endGame">结算/结束游戏</button>
  </view>

  <!-- Scoring Modal -->
  <view class="scoring-modal-container" wx:if="{{showScoring}}">
    <view class="modal-overlay" bind:tap="hideScoringModal"></view>
    <view class="scoring-modal">
      <view class="modal-header">
        <text class="modal-title">记录本轮分数</text>
        <text class="sum-display">总和: {{scoreSum}} <text class="sum-status {{scoreSum === 0 ? 'valid' : 'invalid'}}">{{scoreSum === 0 ? '✓' : '✗'}}</text></text>
      </view>
      
      <view class="player-scores">
        <view class="player-score-item" wx:for="{{players}}" wx:key="openid">
          <text class="player-name">{{item.nickname || '玩家'}}</text>
          <input
            type="number"
            class="score-input"
            placeholder="输入分数"
            value="{{playerScores[item._id]}}"
            bindinput="onScoreChange"
            data-player-id="{{item._id}}"
          />
        </view>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bind:tap="hideScoringModal">取消</button>
        <button 
          class="modal-btn confirm-btn" 
          bind:tap="confirmScores" 
          disabled="{{scoreSum !== 0}}"
        >
          确认 ({{scoreSum === 0 ? '可提交' : '必须为0'}})
        </button>
      </view>
    </view>
  </view>
</view>