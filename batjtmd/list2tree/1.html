<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

  <script>
    // 扁平列表
    // parentId 树状结构
    // 根节点的 parentId 为 0
    // 树结构 -> 递归实现
    const list = [
      { id: 1, parentId: 0, name: 'A' },
      { id: 2, parentId: 1, name: 'B' },
      { id: 3, parentId: 1, name: 'C' },
      { id: 4, parentId: 2, name: 'D' },
    ]

    // 递归
    // 递归公式，分析重复子问题
    // 退出条件，循环结束即退出
    // function list2tree(list, parentId = 0) {
    //   const result = []; // 可以有多个根节点，子节点也不止一个
    //   // 外层循环
    //   list.forEach(item => {
    //     if(item.parentId === parentId){
    //       const children = list2tree(list, item.id);
    //       if(children.length){
    //         item.children = children;
    //       }
    //       result.push(item);
    //     }
    //   })
    //   return result;
    // }

    // 优化，ES6 api
    function list2tree(list, parentId = 0) {
      return list
      .filter(item => item.parentId === parentId)
      .map(item => ({
        // 返回对象
        // 展开原对象
        ...item,
        // 给对象加 children 属性
        children: list2tree(list, item.id)
      }))
    }

    console.log(list2tree(list));

    // 输出
    // [
    //   {
    //     id: 1,
    //     parentId: 0,
    //     name: 'A',
    //     children: [
    //       {
    //         id: 2,
    //         parentId: 1,
    //         name: 'B',
    //         children: [
    //           { id: 4, parentId: 2, name: 'D' }
    //         ]
    //       },
    //       { id: 3, parentId: 1, name: 'C' }
    //     ]
    //   }
    // ]
  </script>
</body>

</html>