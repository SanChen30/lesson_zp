<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script>
        // 模拟 new 的功能
        // rest 运算符，...args 表示剩余参数，将所有参数都放到 args 数组中
        // function objectFactory(Constructor,...args) {
        //     // var obj = {};
        //     var obj = new Object(); // 从空对象开始
        //     Constructor.apply(obj, args); // 绑定 this 指向，运行构造函数
        //     obj.__proto__ = Constructor.prototype; // 空对象的 __proto__ 指向构造函数的 prototype
        //     return obj;
        // }

        function objectFactory() {
            var obj = new Object();
            var Constructor = [].shift.call(arguments); // 等价于 Array.prototype.shift.call(arguments)，arguments只是借用shift方法，并没有变为真数组
            // console.log(Constructor, arguments, Object.prototype.toString.call(arguments));
            // apply 支持类数组对象作为参数列表，无需转换。
            Constructor.apply(obj, arguments);
            obj.__proto__ = Constructor.prototype;
            // arguments 是类数组对象，包含所有传入的参数
            // console.log(arguments, arguments[0]);
            // console.log(Object.prototype.toString.call(arguments)); // [object Arguments]
            // console.log(Object.prototype.toString.call([1, 2, 3])); // [object Array]
            return obj;
        }

        function Person(name, age) {
            this.name = name
            this.age = age
        }
        Person.prototype.species = 'human';
        Person.prototype.sayHi = function () {
            console.log(`你好，我是${this.name}`);
        }

        // 下面两行代码功能一样
        let p = new Person('张三', 18);
        let p2 = objectFactory(Person, '李四', 20);

        console.log(p2.age, p2.species);
        console.log(p, p2);
    </script>
</body>

</html>