# JS 语言工作的底层机制

1. v8引擎

2. 编译阶段、执行阶段

2. 调用栈

全局执行上下文、函数执行上下文

3. 执行上下文

变量环境、词法环境、可执行代码

4. 作用域

变量的查找范围和生命周期

块级作用域：栈结构的词法环境

函数作用域：每个函数执行时创建新的词法环境

全局作用域：整个脚本文件或模块的作用域

## 作用域链

1. 不知道作用域链查找的规则？
  1) 作用域链 是变量的查找路径
    按函数声明的时候(编译阶段)，已经决定，这就是词法作用域


2. 为什么是全局的作用域？
  1) 为什么不是foo()? 极客邦
    错觉：函数在调用栈中的顺序，

## 词法作用域以及词法作用域链

作用域是由代码中函数声明的位置来决定的，而不是由函数调用的位置来决定的。

作用域链也叫词法作用域链，静态的，只和函数声明的位置相关，在编译阶段就决定好了，和调用没有关系

词法作用域是静态的作用域，也称为静态作用域。


## 闭包 closure

无处不在的高级概念

静态的，词法作用域后

函数运行的时候，也有一种情况

就好像函数运行的时候不是在它声明的位置时，也可以访问到它声明时的作用域

1. 闭包基于词法作用域链的理解

形成条件是函数嵌套函数，内部函数可以访问外部函数的变量

被闭包的函数要在外部可以访问到，需要return出来

被闭包的函数执行时，能找到定义它的时候的执行上下文中的变量

foo 函数执行完后，其执行上下文从栈顶弹出了，但是由于返回的setName(),getName() 使用了 foo 函数内部的变量 myName 和 test1，所以这两个变量依然在内存中，不会被垃圾回收，有点像给getName,setName 方法背的一个专属背包，里面存储了这两个变量。

这个背包就叫做闭包。这个闭包里面的变量叫做自由变量。