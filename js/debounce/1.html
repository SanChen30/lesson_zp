<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>防抖</title>
</head>
<body>
    <div>
        <input type="text" id="undebounce" />
        <br>
        <input type="text" id="debounce" />
        <br>
        <input type="text" id="throttle" />
    </div>
    <script>
        // 普通函数
        function ajax(content) {
            console.log('ajax request', content);
        }

        // 高阶函数，参数或返回值（闭包）是函数（函数就是对象）
        // 防抖函数
        function debounce(fn, delay) {
            var id; // 定时器ID，自由变量
            return function(...args) {
                if(id) clearTimeout(id);
                id = setTimeout(() => {
                    fn.apply(this, args);
                },delay);
            }
        }

        // 节流函数
        function throttle(fn, delay) {
            let last, deferTimer; // 上次执行时间，定时器ID
            return function(...args) {
                let now = + new Date(); // 类型转换，将日期对象转换为毫秒数，new Date() 是现在的时间
                if(last && now - last < delay) {
                    clearTimeout(deferTimer);
                    deferTimer = setTimeout(() => {
                        last = now;
                        fn.apply(this, args);
                    }, delay);
                } else {
                    last = now;
                    fn.apply(this, args);
                }
            }
        }

        const inputa = document.getElementById("undebounce");
        const inputb = document.getElementById("debounce");
        const inputc = document.getElementById("throttle");

        // 频繁触发 + 复杂任务
        inputa.addEventListener('keyup', function(e) {
            ajax(e.target.value);
        })

        let debounceAjax = debounce(ajax, 500);
        inputb.addEventListener('keyup', function(e) {
            debounceAjax(e.target.value);
        })

        let throttleAjax = throttle(ajax, 500);
        inputc.addEventListener('keyup', function(e) {
            throttleAjax(e.target.value);
        })

    </script>
</body>
</html>